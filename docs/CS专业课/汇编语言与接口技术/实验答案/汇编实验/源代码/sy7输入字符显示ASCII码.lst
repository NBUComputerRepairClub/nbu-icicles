Microsoft (R) Macro Assembler Version 6.11		    11/01/22 10:32:56
tempfile.asm						     Page 1 - 1


 0000				DATA    SEGMENT
 0000 49 4E 50 55 54 20			MESS    DB      'INPUT one string:',13,10,'$'
       6F 6E 65 20 73 74
       72 69 6E 67 3A 0D
       0A 24
 0014 49 4E 50 55 54 20			ERROR   DB 'INPUT ERRORt',13,10,'$'
       45 52 52 4F 52 74
       0D 0A 24
 0023				DATA    ENDS

 0000				STACK   SEGMENT STACK                   ;栈定义
 0000  0080 [			STA     DB      128 DUP (?)
        00
       ]
 0080 0000			TOP     DW      ?
 0082				STACK   ENDS

 0000				CODES    SEGMENT
				        ASSUME  CS:CODES,DS:DATA,SS:STACK,ES:DATA

 0000				START: ;段初始化
 0000  B8 ---- R			MOV AX,DATA                 
 0003  8E D8			    MOV DS,AX
 0005  8E C0			    MOV ES,AX
 0007  B8 ---- R		    MOV AX,STACK
 000A  8E D0			    MOV SS,AX
 000C  36: A1 0080 R		    MOV AX,TOP
 0010  8B E0			    MOV SP,AX
					
					;提示输入
 0012  B4 09			    MOV     AH,09H                  ;09H号功能显示字符串
 0014  BA 0000 R		    MOV     DX,OFFSET MESS
 0017  CD 21			    INT     21H   
				    ;键盘接收键盘码,结果放AL
 0019  E8 003B			    call GETASCLL  ;读取键盘1个字符保存在DL，ACLL码表示
 001C  52			    PUSH DX;保存输入数据
				    
				    ;输出ASCLL码
 001D  8A C2			    MOV AL,DL
 001F  E8 006F			    CALL DISP1 ;输出AL对应2个字符
 0022  B4 02			    MOV AH,02H ;输出H
 0024  B2 48			    MOV DL,'H'
 0026  CD 21			    int 21H
				    
 0028  E8 001F			    CALL CRLF ;换行
				    ;恢复DX输入数据
 002B  5A			    POP DX
				    ;输出二进制
 002C  E8 0004			  	CALL DISPBIN ;输出二进制
				    
				    ;结束返回DOS
 002F  B4 4C			    MOV AH,4CH
 0031  CD 21			    INT 21H
				    
				    
				;输出显示，循位移环输出最低位   
 0033				DISPBIN PROC NEAR
 0033  B9 0008				MOV CX,8    ;循环8次(二进制位数)
 0036  8A DA			  	MOV BL,DL	;转换结果从DL放入BL
 0038  8A FA			  	MOV BH,DL	;转换结果从DL放入BL
 003A					NEXTSHOW: 
 003A  D1 C3			  	ROL     BX,01  ;循环左移1位，由最高位先输出
 003C  8A D3			  	MOV DL,BL		;输出的放入DL
 003E  80 E2 01			  	AND DL,01H   ;屏蔽高 7 位
 0041  80 C2 30			  	ADD DL,30H	;数字转字符输出
 0044  B4 02			  	MOV AH,02H	;输出DL
 0046  CD 21			  	INT 21H       ;显示某位二进制数
 0048  E2 F0			  	LOOP NEXTSHOW
 004A				DISPBIN ENDP
				;换行函数
 004A				CRLF    PROC    near                      
 004A  B2 0D				MOV DL,0DH
 004C  B4 02			    MOV AH,02H
 004E  CD 21			    INT 21H       ;光标移到第一列              
 0050  B2 0A			    MOV DL,0AH
 0052  B4 02			    MOV AH,02H
 0054  CD 21			    INT 21H       ;光标移到下一行             
 0056  C3			    RET
 0057				CRLF ENDP
				;键盘接收，1个字符对应ASCLL2个数值以2进制存DL中。2个字符DX
 0057				GETASCLL  PROC    NEAR  
 0057  33 C0			  XOR     AX,AX
 0059				again:  ;AH＝01H，回车或空格结束
 0059  B4 01			  MOV     AH,01H ;01H号功能输入一个字符
 005B  CD 21			  INT 21H        ;键盘接收键盘码
 005D  3C 0D			  CMP AL,0DH     ;判回车键
 005F  74 2D			  JZ  done
				  
 0061  3C 20			  CMP AL,20H     ;判空格键
 0063  74 29			  JZ  done
				  ;判为 0 - 9 数字键,满足转换成二进制，存在AL
 0065  3C 30			  CMP AL,30H	 ;与'0'比较
 0067  72 1C			  JB  error0	 ;输入字符<'0',error
				;SUB AL,30H	 ;字符转二进制数字-30H
 0069  3C 3A			CMP AL,3AH     ;并<10,判为 0 - 9 数字键
 006B  72 10			  JB  GETS		 ;AL的值已转为数字，ascll码已处理变为2进制数值
				  ;判 A - F 字母键
 006D  3C 31			CMP AL,31H                  
 006F  72 14			  JB  error0	 ;<'A',error
				;SUB AL,07H	 ;字符转对应二进制数字-30-07H
 0071  3C 46			CMP AL,46H     ;判 A - F 字母键
 0073  76 08			  JBE GETS		 ;AL的值已成功转为数字，
				  ;判 a - f 字母键       
 0075  3C 61			CMP AL,61H	 ;与'a'比较
 0077  72 0C			  JB  error0	 ;<'a',error
 0079  3C 66			CMP AL,66H     ;与'f'比较
 007B  77 08			  JA  error0	 ;>'f',error
				;SUB AL,20H	 ;字符转对应数字-30-07-20H
				  
				  ;AL存储的就是输入字符对应的2进制数字，放入DX
 007D				GETS:   
 007D  B1 04			  MOV     CL,04H	;控制左移次数
 007F  D3 E2			  SHL DX,CL      ;逻辑左移4位，空出4位，接上之前的
 0081  02 D0			  ADD DL,AL      ;当前字符对应2进制数加入 DX 中
 0083  EB D4			  JMP again		 ;输入下一个字符，判断转换
				  ;输入错误
 0085  52			error0: PUSH    DX
 0086  B4 09			  MOV AH,09
 0088  BA 0014 R		  MOV DX,OFFSET ERROR
 008B  CD 21			  INT 21H        ;显示输入错误提示信息
 008D  5A			  POP DX
				  ;返回结果，并换行
 008E  52			done:   PUSH    DX
				  ;CALL CRLF
 008F  5A			  POP DX
 0090  C3			  RET
 0091				GETASCLL  ENDP

 0091				DISP1 PROC    near   ;输出2位16进制数
 0091  51				PUSH CX 
 0092  8A D8				MOV BL,AL ;AL当前要输出的数
 0094  8A D3				MOV DL,BL ;DL存当前要输出的数
 0096  B1 04				MOV CL,04
 0098  D2 C2				ROL DL,CL ;DL循环左移4位
 009A  80 E2 0F				AND DL,0FH ;DL保留低位
 009D  E8 000A				CALL DISPL ;输出第1个数字位
 00A0  8A D3				MOV DL,BL ;DL存当前要输出的数
 00A2  80 E2 0F				AND DL,0FH ;
 00A5  E8 0002				CALL DISPL ;输出第二个数字位
 00A8  59				POP CX
 00A9  C3				RET
 00AA				DISP1 ENDP

 00AA				DISPL PROC    near   ;转字符，DL低四位保存需要输出的数
 00AA  80 C2 30				ADD DL,30H
 00AD  80 FA 3A				CMP DL,3AH
 00B0  72 03				JB DDD
 00B2  80 C2 27				ADD DL,27H
 00B5				DDD:
 00B5  B4 02				MOV AH,02H
 00B7  CD 21				INT 21H	
 00B9  C3				RET
 00BA				DISPL ENDP
 00BA				CODES ENDS
				END START



















Microsoft (R) Macro Assembler Version 6.11		    11/01/22 10:32:56
tempfile.asm						     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

CODES  . . . . . . . . . . . . .	16 Bit	 00BA	  Para	  Private 
DATA . . . . . . . . . . . . . .	16 Bit	 0023	  Para	  Private 
STACK  . . . . . . . . . . . . .	16 Bit	 0082	  Para	  Stack	  


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

CRLF . . . . . . . . . . . . . .	P Near	 004A	  CODES	Length= 000D Public
DISP1  . . . . . . . . . . . . .	P Near	 0091	  CODES	Length= 0019 Public
DISPBIN  . . . . . . . . . . . .	P Near	 0033	  CODES	Length= 0017 Public
  NEXTSHOW . . . . . . . . . . .	L Near	 003A	  CODES	
DISPL  . . . . . . . . . . . . .	P Near	 00AA	  CODES	Length= 0010 Public
  DDD  . . . . . . . . . . . . .	L Near	 00B5	  CODES	
GETASCLL . . . . . . . . . . . .	P Near	 0057	  CODES	Length= 003A Public
  again  . . . . . . . . . . . .	L Near	 0059	  CODES	
  GETS . . . . . . . . . . . . .	L Near	 007D	  CODES	
  error0 . . . . . . . . . . . .	L Near	 0085	  CODES	
  done . . . . . . . . . . . . .	L Near	 008E	  CODES	


Symbols:

                N a m e                 Type     Value    Attr

ERROR  . . . . . . . . . . . . .	Byte	 0014	  DATA	
MESS . . . . . . . . . . . . . .	Byte	 0000	  DATA	
START  . . . . . . . . . . . . .	L Near	 0000	  CODES	
STA  . . . . . . . . . . . . . .	Byte	 0000	  STACK	
TOP  . . . . . . . . . . . . . .	Word	 0080	  STACK	

	   0 Warnings
	   0 Errors
