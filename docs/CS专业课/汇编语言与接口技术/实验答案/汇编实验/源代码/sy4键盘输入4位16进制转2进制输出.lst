Microsoft (R) Macro Assembler Version 6.11		    11/07/22 17:41:57
tempfile.asm						     Page 1 - 1


 0000				DATA    SEGMENT
 0000 69 6E 70 75 74 20		MESS    DB      'input 4*16H: $'
       34 2A 31 36 48 3A
       20 24
 000E 69 6E 70 75 74 20		ERROR   DB      'input error',0DH,0AH,'$'
       65 72 72 6F 72 0D
       0A 24
 001C				DATA    ENDS

 0000				STACK   SEGMENT STACK  ;栈定义
 0000  0080 [			STA     DB      128 DUP (?)
        00
       ]
 0080 0000			TOP     DW      ?
 0082				STACK   ENDS

 0000				CODE    SEGMENT
				        ASSUME  CS:CODE,DS:DATA,SS:STACK,ES:DATA

 0000				START: ;段初始化
 0000  B8 ---- R		  MOV AX,DATA                 
 0003  8E D8			  MOV DS,AX
 0005  8E C0			  MOV ES,AX
 0007  B8 ---- R		  MOV AX,STACK
 000A  8E D0			  MOV SS,AX
 000C  36: A1 0080 R		  MOV AX,TOP
 0010  8B E0			  MOV SP,AX
				  
				  ;提示输入4个16进制
 0012  B4 09			  MOV AH,09H   ;09H号功能显示字符串
 0014  BA 0000 R		  MOV DX,OFFSET MESS
 0017  CD 21			  INT 21H               
				  
				  ;函数：键盘输入数据，并转换后数据存在DX中,为输入4位16进制对应的16个二进制
 0019  E8 001A			  CALL GETNUM                 
				  
				  ;输出显示，循位移环输出最低位
 001C  B9 0010			  MOV CX,16    ;循环16次(二进制位数)
 001F  8B DA			  MOV     BX,DX	;转换结果从DX放入BX
 0021				NEXTSHOW: 
 0021  D1 C3			  ROL     BX,01  ;循环左移1位，由最高位先输出
 0023  8A D3			  MOV DL,BL		;输出的放入DL
 0025  80 E2 01			  AND DL,01H   ;屏蔽高 7 位
 0028  80 C2 30			  ADD DL,30H	;数字转字符输出
 002B  B4 02			  MOV AH,02H	;输出DL
 002D  CD 21			  INT 21H       ;显示某位二进制数
 002F  E2 F0			  LOOP NEXTSHOW
				  
				  ;结束进程，返回控制权限
 0031  B8 4C00			  MOV     AX,4C00H
 0034  CD 21			  INT     21H

 0036				GETNUM  PROC    NEAR  ;键盘接收子程序，2个数值转换2进制存DL中。连续2次，上一次因为左移保留在DH
 0036  33 C0			  XOR     AX,AX
 0038				again:  ;AH＝01H，回车或空格结束
 0038  B4 01			  MOV     AH,01H ;01H号功能输入一个字符
 003A  CD 21			  INT 21H        ;键盘接收键盘码
 003C  3C 0D			  CMP AL,0DH     ;判回车键
 003E  74 33			  JZ  done
				  
 0040  3C 20			  CMP AL,20H     ;判空格键
 0042  74 2F			  JZ  done
				  ;判为 0 - 9 数字键,满足转换成二进制，存在AL
 0044  3C 30			  CMP AL,30H	 ;与'0'比较
 0046  72 22			  JB  error0	 ;输入字符<'0',error
 0048  2C 30			  SUB AL,30H	 ;字符转二进制数字-30H
 004A  3C 0A			  CMP AL,0AH     ;并<10,判为 0 - 9 数字键
 004C  72 14			  JB  GETS		 ;AL的值已转为数字，ascll码已处理变为2进制数值
				  ;判 A - F 字母键
 004E  3C 11			  CMP AL,11H                  
 0050  72 18			  JB  error0	 ;<'A',error
 0052  2C 07			  SUB AL,07H	 ;字符转对应二进制数字-30-07H
 0054  3C 0F			  CMP AL,0FH     ;判 A - F 字母键
 0056  76 0A			  JBE GETS		 ;AL的值已成功转为数字，
				  ;判 a - f 字母键       
 0058  3C 2A			  CMP AL,2AH	 ;与'a'比较
 005A  72 0E			  JB  error0	 ;<'a',error
 005C  3C 2F			  CMP AL,2FH     ;与'f'比较
 005E  77 0A			  JA  error0	 ;>'f',error
 0060  2C 20			  SUB AL,20H	 ;字符转对应数字-30-07-20H
				  
				  ;AL存储的就是输入字符对应的2进制数字，放入DX
 0062				GETS:   
 0062  B1 04			  MOV     CL,04H	;控制左移次数
 0064  D3 E2			  SHL DX,CL      ;逻辑左移4位，空出4位，接上之前的
 0066  02 D0			  ADD DL,AL      ;当前字符对应2进制数加入 DX 中
 0068  EB CE			  JMP again		 ;输入下一个字符，判断转换
				  ;输入错误
 006A  52			error0: PUSH    DX
 006B  B4 09			  MOV AH,09
 006D  BA 000E R		  MOV DX,OFFSET ERROR
 0070  CD 21			  INT 21H        ;显示输入错误提示信息
 0072  5A			  POP DX
				  ;返回结果，并换行
 0073  52			done:   PUSH    DX
				  ;CALL CRLF
 0074  5A			  POP DX
 0075  C3			  RET
 0076				GETNUM  ENDP
				;换行函数
 0076				CRLF    PROC    near                      
 0076  B2 0D				MOV DL,0DH
 0078  B4 02			    MOV AH,02H
 007A  CD 21			    INT 21H       ;光标移到第一列              
 007C  B2 0A			    MOV DL,0AH
 007E  B4 02			    MOV AH,02H
 0080  CD 21			    INT 21H       ;光标移到下一行             
 0082  C3			    RET
 0083				CRLF ENDP

 0083				CODE    ENDS
				        END     START







Microsoft (R) Macro Assembler Version 6.11		    11/07/22 17:41:57
tempfile.asm						     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

CODE . . . . . . . . . . . . . .	16 Bit	 0083	  Para	  Private 
DATA . . . . . . . . . . . . . .	16 Bit	 001C	  Para	  Private 
STACK  . . . . . . . . . . . . .	16 Bit	 0082	  Para	  Stack	  


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

CRLF . . . . . . . . . . . . . .	P Near	 0076	  CODE	Length= 000D Public
GETNUM . . . . . . . . . . . . .	P Near	 0036	  CODE	Length= 0040 Public
  again  . . . . . . . . . . . .	L Near	 0038	  CODE	
  GETS . . . . . . . . . . . . .	L Near	 0062	  CODE	
  error0 . . . . . . . . . . . .	L Near	 006A	  CODE	
  done . . . . . . . . . . . . .	L Near	 0073	  CODE	


Symbols:

                N a m e                 Type     Value    Attr

ERROR  . . . . . . . . . . . . .	Byte	 000E	  DATA	
MESS . . . . . . . . . . . . . .	Byte	 0000	  DATA	
NEXTSHOW . . . . . . . . . . . .	L Near	 0021	  CODE	
START  . . . . . . . . . . . . .	L Near	 0000	  CODE	
STA  . . . . . . . . . . . . . .	Byte	 0000	  STACK	
TOP  . . . . . . . . . . . . . .	Word	 0080	  STACK	

	   0 Warnings
	   0 Errors
